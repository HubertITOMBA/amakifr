// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  MEMBRE
  INVITE
  PRESID
  VICEPR
  SECRET
  VICESE
  COMCPT
  TRESOR
  VTRESO
}

enum MenuRole {
  ADMIN // Administrateur
  PRESID // Pr√©sident
  VICEPR // Vice-Pr√©sident
  SECRET // Secr√©taire
  VICESE // Vice-Secr√©taire
  COMCPT // Comptable/Tr√©sorier
  TRESOR // Tr√©sorier
  VTRESO // Vice-Tr√©sorier
  MEMBRE // Membre simple
  INVITE // Invit√©
  VISITEUR // Visiteur non connect√©
}

// R√¥les d'administration (peut √™tre attribu√© plusieurs fois √† un utilisateur)
// Note: MEMBRE est g√©r√© par UserRole.MEMBRE, pas besoin de le dupliquer ici
enum AdminRole {
  ADMIN // Administrateur - a tous les droits
  PRESID // Pr√©sident - peut tout voir mais ne peut pas tout modifier
  VICEPR // Vice-Pr√©sident - peut tout voir mais ne peut pas tout modifier
  SECRET // Secr√©taire - peut tout voir mais ne peut pas tout modifier
  VICESE // Vice-Secr√©taire - peut tout voir mais ne peut pas tout modifier
  TRESOR // Tr√©sorier - peut tout voir mais ne peut pas tout modifier
  VTRESO // Vice-Tr√©sorier - peut tout voir mais ne peut pas tout modifier
  COMCPT // Comptable/Tr√©sorier - peut tout voir mais ne peut pas tout modifier
}

enum MenuNiveau {
  NAVBAR // 0 - Menu dans la barre de navigation
  SIDEBAR // 1 - Menu dans le menu lat√©ral
}

enum UserStatus {
  Actif
  Inactif
}

enum Civilities {
  Monsieur
  Madame
  Mademoiselle
  Partenaire
}

enum TypeAdhesion {
  AdhesionAnnuelle
  Renouvellement
  Autre
}

enum TypeEvenementFamilial {
  Naissance
  MariageEnfant
  DecesFamille
  AnniversaireSalle
  Autre
}

enum TypeCotisation {
  Forfait
  Assistance
  Anniversaire
  Adhesion
}

enum MoyenPaiement {
  Especes
  Cheque
  Virement
  CarteBancaire
  Stripe
  PayPal
  GooglePay
}

enum TypeTelephone {
  Mobile
  Fixe
  Professionnel
}

enum StatutRelance {
  EnAttente
  Envoyee
  Relancee
  Payee
  Annulee
}

enum TypeRelance {
  Email
  SMS
  Telephone
  Courrier
  Visite
}

enum ElectionStatus {
  Preparation
  Ouverte
  Cloturee
  Annulee
}

enum PositionType {
  President
  VicePresident
  Secretaire
  ViceSecretaire
  Tresorier
  ViceTresorier
  CommissaireComptes
  MembreComiteDirecteur
}

// Mod√®le pour historiser les postes √©lectoraux
model PosteTemplate {
  id          String  @id @default(cuid())
  code        String  @unique @db.VarChar(6) // Code unique de 6 caract√®res g√©n√©r√© automatiquement
  libelle     String  @db.VarChar(255) // Libell√© fran√ßais (ex: "Pr√©sident")
  description String? @db.Text // Description du poste
  ordre       Int     @default(0) // Ordre d'affichage
  actif       Boolean @default(true) // Si le poste est actif (peut √™tre utilis√©)

  // Valeurs par d√©faut pour ce type de poste
  nombreMandatsDefaut Int  @default(1)
  dureeMandatDefaut   Int? // Dur√©e en mois

  // Relations
  positions Position[] // Positions utilisant ce template
  adherents Adherent[] // Adh√©rents ayant ce poste

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String // ID de l'utilisateur qui a cr√©√© le poste
  CreatedBy User     @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("postes_templates")
}

enum CandidacyStatus {
  EnAttente
  Validee
  Rejetee
  Retiree
}

enum VoteStatus {
  Valide
  Invalide
  Blanc
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id                            String                       @id @default(cuid())
  name                          String?                      @unique
  email                         String?                      @unique
  emailVerified                 DateTime?                    @map("email_verified")
  password                      String?
  image                         String?
  accounts                      Account[]
  sessions                      Session[]
  adherent                      Adherent?
  role                          UserRole                     @default(MEMBRE)
  status                        UserStatus                   @default(Inactif)
  depenses                      Depense[]                    @relation("DepenseCreatedBy") // Relation avec les d√©penses cr√©√©es
  depensesValidees              Depense[]                    @relation("DepenseValidatedBy") // Relation avec les d√©penses valid√©es
  typesDepenseCrees             TypeDepense[]                @relation("TypeDepenseCreatedBy") // Types de d√©pense cr√©√©s
  justificatifsUploades         JustificatifDepense[]        @relation("JustificatifUploadedBy") // Justificatifs upload√©s
  typesCotisationMensuelle      TypeCotisationMensuelle[] // Types de cotisation cr√©√©s
  cotisationsDuMoisCreees       CotisationDuMois[]           @relation("CotisationDuMoisCreatedBy") // Cotisations du mois cr√©√©es
  cotisationsMensuelles         CotisationMensuelle[] // Cotisations mensuelles cr√©√©es
  relancesCotisationMensuelle   RelanceCotisationMensuelle[] // Relances cr√©√©es
  dettesInitialesCreees         DetteInitiale[]              @relation("DetteInitialeCreatedBy") // Dettes initiales cr√©√©es
  paiementsCreees               PaiementCotisation[]         @relation("PaiementCreatedBy") // Paiements cr√©√©s
  assistancesCreees             Assistance[]                 @relation("AssistanceCreatedBy") // Assistances cr√©√©es
  evenements                    Evenement[] // √âv√©nements cr√©√©s
  conversations                 Conversation[] // Conversations cr√©√©es
  conversationParticipants      ConversationParticipant[] // Participations aux conversations
  messages                      Message[] // Messages envoy√©s
  postesTemplates               PosteTemplate[] // Postes cr√©√©s
  messageReactions              MessageReaction[] // R√©actions aux messages
  configurationsFraisAdhesion   ConfigurationFraisAdhesion[] @relation("ConfigurationFraisAdhesionCreatedBy") // Configurations de frais d'adh√©sion cr√©√©es
  adminRoles                    UserAdminRole[]              @relation("UserAdminRoles") // R√¥les d'administration de l'utilisateur
  adminRolesAttributed          UserAdminRole[]              @relation("UserAdminRoleCreator") // R√¥les d'administration attribu√©s par cet utilisateur
  notifications                 Notification[] // Notifications re√ßues
  emailsReceived                Email[]                      @relation("EmailRecipient") // Emails re√ßus
  emailsSent                    Email[]                      @relation("EmailCreatedBy") // Emails envoy√©s
  suppressionsEffectuees        SuppressionAdherent[]        @relation("SuppressionDeletedBy") // Suppressions d'adh√©rents effectu√©es
  dataDeletionRequests          DataDeletionRequest[]        @relation("DataDeletionRequestUser") // Demandes de suppression de donn√©es
  dataDeletionRequestsVerified  DataDeletionRequest[]        @relation("DataDeletionRequestVerifiedBy") // Demandes v√©rifi√©es
  dataDeletionRequestsApproved  DataDeletionRequest[]        @relation("DataDeletionRequestApprovedBy") // Demandes approuv√©es
  dataDeletionRequestsRejected  DataDeletionRequest[]        @relation("DataDeletionRequestRejectedBy") // Demandes rejet√©es
  dataDeletionRequestsCompleted DataDeletionRequest[]        @relation("DataDeletionRequestCompletedBy") // Demandes compl√©t√©es
  documents                     Document[] // Documents upload√©s
  badgesAttribues               BadgeAttribution[] // Badges attribu√©s √† cet utilisateur
  ressourcesCreees              Ressource[]                  @relation("RessourceCreatedBy") // Ressources cr√©√©es
  reservationsConfirmees        Reservation[]                @relation("ReservationConfirmeePar") // R√©servations confirm√©es
  mediaGalerieCrees             MediaGalerie[]               @relation("MediaGalerieCreatedBy") // M√©dias de galerie cr√©√©s
  rapportsReunionCrees          RapportReunion[]             @relation("RapportReunionCreatedBy") // Rapports de r√©union cr√©√©s
  rapportsReunionModifies       RapportReunion[]             @relation("RapportReunionUpdatedBy") // Rapports de r√©union modifi√©s
  menusCreated                  Menu[]                       @relation("MenuCreatedBy") // Menus cr√©√©s
  activities                    UserActivity[]               @relation("UserActivities") // Activit√©s de l'utilisateur
  projetsCrees                  Projet[]                     @relation("ProjetCreatedBy") // Projets cr√©√©s

  lastLogin DateTime? @updatedAt
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  remember_token        String?                @db.VarChar(100)
  isTwoFactorEnabled    Boolean                @default(false)
  twoFactorConfirmation TwoFactorConfirmation?

  @@map("users")
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("verification_tokens")
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("password_reset_tokens")
}

model TwoFactorToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("two_factor_tokens")
}

model TwoFactorConfirmation {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId])
  @@map("two_factor_confirmations")
}

model Adherent {
  id                            String                       @id @default(cuid())
  civility                      Civilities?                  @default(Monsieur)
  firstname                     String                       @db.VarChar(255)
  lastname                      String                       @db.VarChar(255)
  dateNaissance                 DateTime? // Date de naissance
  typeAdhesion                  TypeAdhesion? // Type d'adh√©sion
  profession                    String?                      @db.VarChar(255) // Profession (optionnel)
  anneePromotion                String?                      @db.VarChar(10) // Ann√©e de promotion √† Kipaku (ex: "2010" ou "Non")
  centresInteret                String?                      @db.Text // Centres d'int√©r√™t
  autorisationImage             Boolean                      @default(false) // Autorisation d'utilisation de l'image
  accepteCommunications         Boolean                      @default(true) // Acceptation des communications
  nombreEnfants                 Int                          @default(0) // Nombre d'enfants
  evenementsFamiliaux           String?                      @db.Text // JSON array des types d'√©v√©nements familiaux
  // Champs pour la gestion des frais d'adh√©sion
  datePremiereAdhesion          DateTime? // Date de premi√®re adh√©sion √† l'association
  fraisAdhesionPaye             Boolean                      @default(false) // Indique si les frais d'adh√©sion ont √©t√© pay√©s
  datePaiementFraisAdhesion     DateTime? // Date de paiement des frais d'adh√©sion
  estAncienAdherent             Boolean                      @default(false) // Flag pour marquer les anciens adh√©rents
  // Champs pour le passeport adh√©rent
  numeroPasseport               String?                      @db.VarChar(50) // Num√©ro unique du passeport AMAKI
  dateGenerationPasseport       DateTime? // Date de g√©n√©ration du passeport
  // Poste de l'adh√©rent dans l'association
  posteTemplateId               String? // Poste de l'adh√©rent (par d√©faut: Membre de l'association)
  PosteTemplate                 PosteTemplate?               @relation(fields: [posteTemplateId], references: [id], onDelete: SetNull)
  Adresse                       Adresse[]
  Cotisations                   Cotisation[]
  Telephones                    Telephone[]
  ObligationsCotisation         ObligationCotisation[]
  Relances                      Relance[]
  Candidacies                   Candidacy[]
  Votes                         Vote[]
  CotisationsMensuelles         CotisationMensuelle[] // Cotisations mensuelles
  RelancesCotisationMensuelle   RelanceCotisationMensuelle[] // Relances cotisations mensuelles
  CotisationsDuMoisBeneficiaire CotisationDuMois[]           @relation("CotisationDuMoisBeneficiaire") // Cotisations du mois dont l'adh√©rent est b√©n√©ficiaire (assistances)
  InscriptionsEvenements        InscriptionEvenement[] // Inscriptions aux √©v√©nements
  idees                         Idee[] // Id√©es soumises par l'adh√©rent
  commentairesIdee              CommentaireIdee[] // Commentaires sur les id√©es
  approbationsIdee              ApprobationIdee[] // Approbations des id√©es
  Enfants                       Enfant[] // Enfants de l'adh√©rent
  DettesInitiales               DetteInitiale[] // Dettes initiales
  Paiements                     PaiementCotisation[] // Paiements effectu√©s
  Assistances                   Assistance[] // Assistances re√ßues
  Avoirs                        Avoir[] // Avoirs (exc√©dents de paiement)
  documents                     Document[]                   @relation("DocumentAdherent") // Documents li√©s √† l'adh√©rent
  Reservations                  Reservation[] // R√©servations effectu√©es
  affectationsSousProjets       AffectationSousProjet[] // Affectations aux sous-projets/t√¢ches
  commentairesTaches            CommentaireTache[] // Commentaires sur les t√¢ches
  created_at                    DateTime?                    @db.Timestamp(0)
  updated_at                    DateTime?                    @db.Timestamp(0)
  userId                        String                       @unique
  User                          User                         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("adherent")
}

// Configuration pour les frais d'adh√©sion
model ConfigurationFraisAdhesion {
  id                   String   @id @default(cuid())
  montantFraisAdhesion Decimal  @db.Decimal(10, 2) // Montant des frais d'adh√©sion
  actif                Boolean  @default(true)
  description          String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  createdBy            String
  CreatedBy            User     @relation("ConfigurationFraisAdhesionCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("configuration_frais_adhesion")
}

model Adresse {
  id          String   @id @default(cuid())
  adherentId  String
  streetnum   String?
  street1     String?
  street2     String?
  codepost    String?
  city        String?
  country     String?
  // Champs pour l'API BAN (Base Adresse Nationale)
  banId       String?  @db.VarChar(100) // ID de l'adresse dans l'API BAN
  label       String?  @db.VarChar(500) // Adresse compl√®te format√©e (ex: "10 Rue de la Paix, 75001 Paris")
  housenumber String?  @db.VarChar(20) // Num√©ro de maison
  street      String?  @db.VarChar(200) // Nom de la rue
  postcode    String?  @db.VarChar(10) // Code postal (normalis√©)
  citycode    String?  @db.VarChar(10) // Code INSEE de la commune
  department  String?  @db.VarChar(10) // Code d√©partement
  region      String?  @db.VarChar(100) // Nom de la r√©gion
  latitude    Float? // Coordonn√©e GPS latitude
  longitude   Float? // Coordonn√©e GPS longitude
  score       Float? // Score de pertinence (0-1)
  type        String?  @db.VarChar(50) // Type d'adresse (housenumber, street, municipality, etc.)
  metadata    Json? // M√©tadonn√©es suppl√©mentaires de l'API BAN
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  @@index([banId])
  @@index([postcode])
  @@index([citycode])
  @@index([department])
  @@map("adresse")
}

// Table pour stocker les adresses normalis√©es de l'API BAN (cache)
model BanAddress {
  id          String   @id @default(cuid())
  banId       String   @unique @db.VarChar(100) // ID unique de l'API BAN
  label       String   @db.VarChar(500) // Adresse compl√®te format√©e
  housenumber String?  @db.VarChar(20)
  street      String?  @db.VarChar(200)
  postcode    String   @db.VarChar(10)
  city        String   @db.VarChar(200)
  citycode    String   @db.VarChar(10) // Code INSEE
  department  String?  @db.VarChar(10)
  region      String?  @db.VarChar(100)
  latitude    Float
  longitude   Float
  score       Float? // Score de pertinence
  type        String   @db.VarChar(50) // housenumber, street, municipality, etc.
  metadata    Json? // M√©tadonn√©es compl√®tes de l'API BAN
  searchText  String?  @db.Text // Texte de recherche pour indexation
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([postcode])
  @@index([citycode])
  @@index([department])
  @@index([city])
  @@index([street])
  @@index([searchText])
  @@map("ban_address")
}

model Cotisation {
  id             String         @id @default(cuid())
  adherentId     String
  type           TypeCotisation
  montant        Decimal        @db.Decimal(10, 2)
  dateCotisation DateTime       @default(now())
  moyenPaiement  MoyenPaiement
  description    String?        @db.Text
  reference      String?        @db.VarChar(100)
  statut         String         @default("Valide") // Valide, Annule, EnAttente
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  @@map("cotisations")
}

model Telephone {
  id           String        @id @default(cuid())
  adherentId   String
  numero       String        @db.VarChar(20)
  type         TypeTelephone
  estPrincipal Boolean       @default(false)
  description  String?       @db.VarChar(255)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  @@map("telephones")
}

// Mod√®le pour les enfants des adh√©rents
model Enfant {
  id            String    @id @default(cuid())
  adherentId    String
  prenom        String    @db.VarChar(255)
  dateNaissance DateTime? // Date de naissance
  age           Int? // √Çge (calcul√© ou saisi)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  @@map("enfants")
}

model ObligationCotisation {
  id             String         @id @default(cuid())
  adherentId     String
  type           TypeCotisation
  montantAttendu Decimal        @db.Decimal(10, 2)
  montantPaye    Decimal        @default(0) @db.Decimal(10, 2)
  montantRestant Decimal        @db.Decimal(10, 2)
  dateEcheance   DateTime
  periode        String         @db.VarChar(50) // ex: "2024-01", "2024-Anniversaire"
  statut         String         @default("EnAttente") // EnAttente, PartiellementPaye, Paye, EnRetard
  description    String?        @db.Text
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  Adherent          Adherent             @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  Relances          Relance[]
  Paiements         PaiementCotisation[] // Paiements li√©s √† cette obligation
  UtilisationsAvoir UtilisationAvoir[] // Utilisations d'avoirs pour cette obligation

  @@map("obligations_cotisation")
}

model Relance {
  id                     String        @id @default(cuid())
  adherentId             String
  obligationCotisationId String
  type                   TypeRelance
  statut                 StatutRelance @default(EnAttente)
  dateEnvoi              DateTime?
  dateRelance            DateTime?
  contenu                String?       @db.Text
  reponse                String?       @db.Text
  montantRappele         Decimal?      @db.Decimal(10, 2)
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt

  Adherent             Adherent             @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  ObligationCotisation ObligationCotisation @relation(fields: [obligationCotisationId], references: [id], onDelete: Cascade)

  @@map("relances")
}

// Mod√®les pour le syst√®me d'√©lections
model Election {
  id          String         @id @default(cuid())
  titre       String         @db.VarChar(255)
  description String?        @db.Text
  status      ElectionStatus @default(Preparation)

  // Dates importantes
  dateOuverture          DateTime
  dateCloture            DateTime
  dateClotureCandidature DateTime // Date limite pour postuler (obligatoire: dateOuverture < dateClotureCandidature < dateScrutin < dateCloture)
  dateScrutin            DateTime

  // Configuration
  nombreMandats  Int     @default(1) // Nombre de postes √† pourvoir
  quorumRequis   Int? // Quorum requis pour valider l'√©lection
  majoriteRequis String? @db.VarChar(50) // "Absolue", "Relative", "Qualifi√©e"

  // Relations
  positions   Position[]
  candidacies Candidacy[]
  votes       Vote[]

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String // ID de l'utilisateur qui a cr√©√© l'√©lection

  @@map("elections")
}

model Position {
  id          String       @id @default(cuid())
  electionId  String
  type        PositionType // Conserv√© pour r√©trocompatibilit√©
  titre       String       @db.VarChar(255)
  description String?      @db.Text

  // Nouvelle r√©f√©rence au template de poste
  posteTemplateId String? // Optionnel pour migration progressive
  PosteTemplate   PosteTemplate? @relation(fields: [posteTemplateId], references: [id], onDelete: SetNull)

  // Configuration sp√©cifique au poste
  nombreMandats Int     @default(1)
  dureeMandat   Int? // Dur√©e en mois
  conditions    String? @db.Text // Conditions sp√©cifiques

  // Relations
  election    Election    @relation(fields: [electionId], references: [id], onDelete: Cascade)
  candidacies Candidacy[]
  votes       Vote[]

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([electionId, type])
  @@index([posteTemplateId])
  @@map("positions")
}

model Candidacy {
  id         String @id @default(cuid())
  electionId String
  positionId String
  adherentId String

  // Informations de candidature
  status     CandidacyStatus @default(EnAttente)
  motivation String?         @db.Text
  programme  String?         @db.Text

  // Documents joints
  documents String? @db.Text // JSON array des URLs des documents

  // Validation
  valideePar     String? // ID de l'utilisateur qui a valid√©
  dateValidation DateTime?
  commentaires   String?   @db.Text

  // Relations
  election Election @relation(fields: [electionId], references: [id], onDelete: Cascade)
  position Position @relation(fields: [positionId], references: [id], onDelete: Cascade)
  adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  votes    Vote[]

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([electionId, positionId, adherentId])
  @@map("candidacies")
}

model Vote {
  id         String @id @default(cuid())
  electionId String
  positionId String
  adherentId String // Adh√©rent qui vote

  // Candidat choisi (peut √™tre null pour vote blanc)
  candidacyId String?

  // Informations du vote
  status    VoteStatus @default(Valide)
  dateVote  DateTime   @default(now())
  ipAddress String?    @db.VarChar(45) // Pour audit
  userAgent String?    @db.VarChar(500) // Pour audit

  // Relations
  election  Election   @relation(fields: [electionId], references: [id], onDelete: Cascade)
  position  Position   @relation(fields: [positionId], references: [id], onDelete: Cascade)
  adherent  Adherent   @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  candidacy Candidacy? @relation(fields: [candidacyId], references: [id], onDelete: SetNull)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([electionId, positionId, adherentId])
  @@map("votes")
}

model TypeDepense {
  id          String   @id @default(cuid())
  titre       String   @db.VarChar(200)
  description String?  @db.Text
  actif       Boolean  @default(true)
  createdBy   String // ID de l'admin qui a cr√©√© le type
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  CreatedBy User      @relation("TypeDepenseCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  Depenses  Depense[] // D√©penses de ce type

  @@map("types_depense")
}

model Depense {
  id            String   @id @default(cuid())
  libelle       String   @db.VarChar(200)
  montant       Decimal  @db.Decimal(10, 2)
  dateDepense   DateTime
  typeDepenseId String? // R√©f√©rence au type de d√©pense (remplace categorie)
  categorie     String?  @db.VarChar(100) // Conserv√© pour compatibilit√©, sera remplac√© par typeDepenseId
  description   String?  @db.Text
  justificatif  String?  @db.VarChar(500) // URL du fichier upload√© (conserv√© pour compatibilit√©)
  statut        String   @default("EnAttente") // EnAttente, Valide, Rejete
  createdBy     String // ID de l'admin qui a cr√©√© la d√©pense
  validatedBy   String? // ID de l'admin qui a valid√© la d√©pense (null si non valid√©e)

  // Relations
  CreatedBy     User                  @relation("DepenseCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  ValidatedBy   User?                 @relation("DepenseValidatedBy", fields: [validatedBy], references: [id], onDelete: SetNull)
  TypeDepense   TypeDepense?          @relation(fields: [typeDepenseId], references: [id], onDelete: SetNull)
  Justificatifs JustificatifDepense[] // Justificatifs de la d√©pense

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("depenses")
}

model JustificatifDepense {
  id         String @id @default(cuid())
  depenseId  String // R√©f√©rence √† la d√©pense
  nomFichier String @db.VarChar(255) // Nom original du fichier
  chemin     String @db.VarChar(500) // Chemin relatif dans /public/ressources/justificatifs
  typeMime   String @db.VarChar(100) // Type MIME (application/pdf, image/jpeg, etc.)
  taille     Int // Taille en octets
  uploadedBy String // ID de l'admin qui a upload√© le fichier

  // Relations
  Depense    Depense @relation(fields: [depenseId], references: [id], onDelete: Cascade)
  UploadedBy User    @relation("JustificatifUploadedBy", fields: [uploadedBy], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("justificatifs_depense")
}

model TypeCotisationMensuelle {
  id            String  @id @default(cuid())
  nom           String  @db.VarChar(100) // ex: "Forfait", "Occasionnel", "Formation", etc.
  description   String? @db.Text
  montant       Decimal @db.Decimal(10, 2)
  obligatoire   Boolean @default(true) // Si la cotisation est obligatoire
  actif         Boolean @default(true) // Si le type est actuellement utilis√©
  ordre         Int     @default(0) // Ordre d'affichage
  aBeneficiaire Boolean @default(false) // Si ce type n√©cessite un adh√©rent b√©n√©ficiaire (pour les assistances)
  createdBy     String // ID de l'admin qui a cr√©√© le type

  // Relations
  CreatedBy             User                  @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  CotisationsMensuelles CotisationMensuelle[] // Les cotisations cr√©√©es avec ce type
  CotisationsDuMois     CotisationDuMois[] // Les cotisations du mois avec ce type

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("types_cotisation_mensuelle")
}

// Table pour g√©rer les cotisations du mois (planification par l'admin)
// Permet √† l'admin de cr√©er, modifier, rechercher et trier les cotisations par mois/ann√©e
// Pour les assistances, contient l'adh√©rent b√©n√©ficiaire qui ne paiera pas cette cotisation
model CotisationDuMois {
  id                     String   @id @default(cuid())
  periode                String   @db.VarChar(50) // ex: "2024-01", "2024-02"
  annee                  Int
  mois                   Int
  typeCotisationId       String // R√©f√©rence au type de cotisation
  montantBase            Decimal  @db.Decimal(10, 2) // Montant de base pour ce type de cotisation ce mois
  dateEcheance           DateTime // Date d'√©ch√©ance pour cette cotisation
  description            String?  @db.Text
  statut                 String   @default("Planifie") // Planifie, Cree, Annule
  adherentBeneficiaireId String? // Pour les assistances : l'adh√©rent b√©n√©ficiaire qui ne paiera pas
  createdBy              String // ID de l'admin qui a cr√©√© la cotisation du mois

  // Relations
  TypeCotisation        TypeCotisationMensuelle @relation(fields: [typeCotisationId], references: [id], onDelete: Cascade)
  CreatedBy             User                    @relation("CotisationDuMoisCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  AdherentBeneficiaire  Adherent?               @relation("CotisationDuMoisBeneficiaire", fields: [adherentBeneficiaireId], references: [id], onDelete: SetNull)
  CotisationsMensuelles CotisationMensuelle[] // Les cotisations cr√©√©es √† partir de cette planification

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Contrainte : un adh√©rent ne peut avoir qu'une seule assistance par mois
  // (peu importe le type d'assistance : mariage, anniversaire, etc.)
  // Cette contrainte s'applique uniquement quand adherentBeneficiaireId n'est pas null
  // PostgreSQL permet plusieurs NULL dans une contrainte unique, donc les types sans b√©n√©ficiaire ne sont pas affect√©s
  @@unique([periode, adherentBeneficiaireId], name: "unique_adherent_assistance_periode")
  @@index([annee])
  @@index([mois])
  @@index([statut])
  @@index([adherentBeneficiaireId])
  @@index([periode, typeCotisationId])
  @@map("cotisations_du_mois")
}

model CotisationMensuelle {
  id                 String   @id @default(cuid())
  periode            String   @db.VarChar(50) // ex: "2024-01", "2024-02"
  annee              Int
  mois               Int
  typeCotisationId   String // R√©f√©rence au type de cotisation
  adherentId         String // Adh√©rent concern√©
  montantAttendu     Decimal  @db.Decimal(10, 2)
  montantPaye        Decimal  @default(0) @db.Decimal(10, 2)
  montantRestant     Decimal  @db.Decimal(10, 2)
  dateEcheance       DateTime
  statut             String   @default("EnAttente") // EnAttente, PartiellementPaye, Paye, EnRetard
  description        String?  @db.Text
  cotisationDuMoisId String? // R√©f√©rence √† la cotisation du mois (planification)
  createdBy          String // ID de l'admin qui a cr√©√© la cotisation

  // Relations
  TypeCotisation    TypeCotisationMensuelle      @relation(fields: [typeCotisationId], references: [id], onDelete: Cascade)
  Adherent          Adherent                     @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  CreatedBy         User                         @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  CotisationDuMois  CotisationDuMois?            @relation(fields: [cotisationDuMoisId], references: [id], onDelete: SetNull)
  Relances          RelanceCotisationMensuelle[]
  Paiements         PaiementCotisation[] // Paiements li√©s √† cette cotisation mensuelle
  UtilisationsAvoir UtilisationAvoir[] // Utilisations d'avoirs pour cette cotisation

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([periode, typeCotisationId, adherentId])
  @@map("cotisations_mensuelles")
}

model RelanceCotisationMensuelle {
  id                    String    @id @default(cuid())
  cotisationMensuelleId String
  adherentId            String
  type                  String    @default("Email") // Email, SMS, Courrier
  statut                String    @default("EnAttente") // EnAttente, Envoye, Lu, Repondu
  dateEnvoi             DateTime?
  dateRelance           DateTime?
  contenu               String?   @db.Text
  reponse               String?   @db.Text
  montantRappele        Decimal?  @db.Decimal(10, 2)
  createdBy             String // ID de l'admin qui a cr√©√© la relance

  // Relations
  CotisationMensuelle CotisationMensuelle @relation(fields: [cotisationMensuelleId], references: [id], onDelete: Cascade)
  Adherent            Adherent            @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  CreatedBy           User                @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("relances_cotisation_mensuelle")
}

// Mod√®le pour les dettes initiales (2024, 2025, etc.)
model DetteInitiale {
  id             String   @id @default(cuid())
  adherentId     String
  annee          Int // Ann√©e de la dette (2024, 2025, etc.)
  montant        Decimal  @db.Decimal(10, 2) // Montant total de la dette pour l'ann√©e
  montantPaye    Decimal  @default(0) @db.Decimal(10, 2) // Montant d√©j√† pay√©
  montantRestant Decimal  @db.Decimal(10, 2) // Montant restant √† payer
  description    String?  @db.Text
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String // ID de l'admin qui a cr√©√© la dette

  // Relations
  Adherent          Adherent             @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  CreatedBy         User                 @relation("DetteInitialeCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  Paiements         PaiementCotisation[] // Paiements li√©s √† cette dette
  UtilisationsAvoir UtilisationAvoir[] // Utilisations d'avoirs pour cette dette

  @@unique([adherentId, annee])
  @@map("dettes_initiales")
}

// Mod√®le pour les paiements de cotisations (partiels ou complets)
model PaiementCotisation {
  id            String        @id @default(cuid())
  adherentId    String
  montant       Decimal       @db.Decimal(10, 2)
  datePaiement  DateTime      @default(now())
  moyenPaiement MoyenPaiement
  reference     String?       @db.VarChar(100) // R√©f√©rence du paiement (ch√®que, virement, etc.)
  description   String?       @db.Text

  // Liens vers les obligations/cotisations pay√©es
  obligationCotisationId String? // Si le paiement concerne une obligation
  cotisationMensuelleId  String? // Si le paiement concerne une cotisation mensuelle
  detteInitialeId        String? // Si le paiement concerne une dette initiale
  assistanceId           String? // Si le paiement concerne une assistance

  // Informations pour les paiements en ligne
  stripePaymentIntentId String? @unique @db.VarChar(255) // ID du PaymentIntent Stripe
  stripeSessionId       String? @unique @db.VarChar(255) // ID de la session Stripe Checkout
  paypalOrderId         String? @unique @db.VarChar(255) // ID de la commande PayPal
  transactionId         String? @unique @db.VarChar(255) // ID de transaction unique (pour tous les prestataires)
  receiptUrl            String? @db.VarChar(500) // URL du re√ßu PDF g√©n√©r√©
  receiptGenerated      Boolean @default(false) // Si le re√ßu a √©t√© g√©n√©r√©

  statut    String @default("Valide") // Valide, Annule, EnAttente, EnCours (pour paiements en ligne)
  createdBy String // ID de l'admin qui a enregistr√© le paiement (ou "system" pour paiements en ligne)

  // Relations
  Adherent             Adherent              @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  ObligationCotisation ObligationCotisation? @relation(fields: [obligationCotisationId], references: [id], onDelete: SetNull)
  CotisationMensuelle  CotisationMensuelle?  @relation(fields: [cotisationMensuelleId], references: [id], onDelete: SetNull)
  DetteInitiale        DetteInitiale?        @relation(fields: [detteInitialeId], references: [id], onDelete: SetNull)
  Assistance           Assistance?           @relation(fields: [assistanceId], references: [id], onDelete: SetNull)
  CreatedBy            User                  @relation("PaiementCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  Avoir                Avoir?                @relation("AvoirFromPaiement") // Avoir cr√©√© par ce paiement (si exc√©dent)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("paiements_cotisation")
}

// Mod√®le pour les avoirs (exc√©dents de paiement)
model Avoir {
  id             String  @id @default(cuid())
  adherentId     String
  montant        Decimal @db.Decimal(10, 2) // Montant de l'avoir
  montantUtilise Decimal @default(0) @db.Decimal(10, 2) // Montant d√©j√† utilis√©
  montantRestant Decimal @db.Decimal(10, 2) // Montant restant disponible

  // Origine de l'avoir
  paiementId  String? @unique // ID du paiement qui a cr√©√© cet avoir (si applicable) - unique car un paiement ne peut cr√©er qu'un seul avoir
  description String? @db.Text // Description de l'origine de l'avoir

  // Utilisation de l'avoir
  statut String @default("Disponible") // Disponible, Utilise, Expire

  // Relations
  Adherent     Adherent            @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  Paiement     PaiementCotisation? @relation("AvoirFromPaiement", fields: [paiementId], references: [id], onDelete: SetNull)
  Utilisations UtilisationAvoir[] // Utilisations de cet avoir

  // M√©tadonn√©es
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  dateExpiration DateTime? // Date d'expiration de l'avoir (optionnel)

  @@index([adherentId])
  @@index([statut])
  @@map("avoirs")
}

// Mod√®le pour les utilisations d'avoirs
model UtilisationAvoir {
  id      String  @id @default(cuid())
  avoirId String
  montant Decimal @db.Decimal(10, 2) // Montant utilis√©

  // Lien vers ce qui a √©t√© pay√© avec cet avoir
  cotisationMensuelleId  String? // Si utilis√© pour une cotisation mensuelle
  obligationCotisationId String? // Si utilis√© pour une obligation
  detteInitialeId        String? // Si utilis√© pour une dette initiale
  assistanceId           String? // Si utilis√© pour une assistance

  description     String?  @db.Text
  dateUtilisation DateTime @default(now())

  // Relations
  Avoir                Avoir                 @relation(fields: [avoirId], references: [id], onDelete: Cascade)
  CotisationMensuelle  CotisationMensuelle?  @relation(fields: [cotisationMensuelleId], references: [id], onDelete: SetNull)
  ObligationCotisation ObligationCotisation? @relation(fields: [obligationCotisationId], references: [id], onDelete: SetNull)
  DetteInitiale        DetteInitiale?        @relation(fields: [detteInitialeId], references: [id], onDelete: SetNull)
  Assistance           Assistance?           @relation(fields: [assistanceId], references: [id], onDelete: SetNull)

  // M√©tadonn√©es
  createdAt DateTime @default(now())

  @@index([avoirId])
  @@map("utilisations_avoir")
}

// Mod√®le pour les assistances (50‚Ç¨ pour naissance, d√©c√®s, anniversaire, mariage)
model Assistance {
  id             String                @id @default(cuid())
  adherentId     String
  type           TypeEvenementFamilial // Naissance, MariageEnfant, DecesFamille, AnniversaireSalle, Autre
  montant        Decimal               @default(50.00) @db.Decimal(10, 2) // Montant fixe de 50‚Ç¨
  dateEvenement  DateTime // Date de l'√©v√©nement
  montantPaye    Decimal               @default(0) @db.Decimal(10, 2)
  montantRestant Decimal               @db.Decimal(10, 2)
  statut         String                @default("EnAttente") // EnAttente, Paye, Annule
  description    String?               @db.Text
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  createdBy      String // ID de l'admin qui a cr√©√© l'assistance

  // Relations
  Adherent          Adherent             @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  CreatedBy         User                 @relation("AssistanceCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  Paiements         PaiementCotisation[] // Paiements li√©s √† cette assistance
  UtilisationsAvoir UtilisationAvoir[] // Utilisations d'avoirs pour cette assistance

  @@map("assistances")
}

// Mod√®le pour la gestion des √©v√©nements
model Evenement {
  id                    String    @id @default(cuid())
  titre                 String    @db.VarChar(200)
  description           String    @db.Text
  contenu               String?   @db.Text // Contenu d√©taill√© de l'√©v√©nement
  dateDebut             DateTime
  dateFin               DateTime?
  dateAffichage         DateTime // Date √† partir de laquelle l'√©v√©nement est visible
  dateFinAffichage      DateTime // Date jusqu'√† laquelle l'√©v√©nement reste visible
  lieu                  String?   @db.VarChar(200)
  adresse               String?   @db.Text
  categorie             String    @default("General") @db.VarChar(50) // General, Formation, Social, Sportif, Culturel
  statut                String    @default("Brouillon") // Brouillon, Publie, Archive
  estPublic             Boolean   @default(true) // Si true : visible par tout le monde sur /evenements, si false : r√©serv√© aux adh√©rents sur /agenda
  imagePrincipale       String?   @db.VarChar(500) // URL de l'image principale
  images                String?   @db.Text // JSON array des URLs d'images suppl√©mentaires
  prix                  Decimal?  @db.Decimal(10, 2) // Prix de participation (optionnel)
  placesDisponibles     Int? // Nombre de places disponibles
  placesReservees       Int       @default(0) // Nombre de places r√©serv√©es
  inscriptionRequis     Boolean   @default(false) // Si une inscription est requise
  dateLimiteInscription DateTime? // Date limite pour s'inscrire
  contactEmail          String?   @db.VarChar(100)
  contactTelephone      String?   @db.VarChar(20)
  tags                  String?   @db.Text // JSON array des tags
  createdBy             String // ID de l'admin qui a cr√©√© l'√©v√©nement

  // Relations
  CreatedBy     User                   @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  Inscriptions  InscriptionEvenement[] // Inscriptions √† cet √©v√©nement
  Conversations Conversation[] // Conversations li√©es √† cet √©v√©nement

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("evenements")
}

// Mod√®le pour les inscriptions aux √©v√©nements
model InscriptionEvenement {
  id              String   @id @default(cuid())
  evenementId     String
  adherentId      String? // Optionnel pour permettre les inscriptions de visiteurs
  statut          String   @default("EnAttente") // EnAttente, Confirmee, Annulee
  dateInscription DateTime @default(now())
  commentaires    String?  @db.Text
  nombrePersonnes Int      @default(1) // Nombre de personnes inscrites

  // Informations du visiteur (pour les non-adh√©rents)
  visiteurNom       String? @db.VarChar(255)
  visiteurEmail     String? @db.VarChar(255)
  visiteurTelephone String? @db.VarChar(20)
  visiteurAdresse   String? @db.Text

  // Relations
  Evenement Evenement @relation(fields: [evenementId], references: [id], onDelete: Cascade)
  Adherent  Adherent? @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([evenementId, adherentId])
  @@index([evenementId, visiteurEmail])
  @@map("inscriptions_evenements")
}

// Mod√®le pour le syst√®me de chat
model Conversation {
  id          String  @id @default(cuid())
  titre       String? @db.VarChar(200) // Titre optionnel pour les conversations de groupe
  type        String  @default("Privee") // Privee, Groupe, Evenement
  evenementId String? // Pour les conversations li√©es √† un √©v√©nement
  createdBy   String // ID de l'utilisateur qui a cr√©√© la conversation

  // Relations
  CreatedBy    User                      @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  Evenement    Evenement?                @relation(fields: [evenementId], references: [id], onDelete: Cascade)
  Participants ConversationParticipant[] // Participants √† la conversation
  Messages     Message[] // Messages de la conversation

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("conversations")
}

// Mod√®le pour les participants d'une conversation
model ConversationParticipant {
  id             String    @id @default(cuid())
  conversationId String
  userId         String
  role           String    @default("Participant") // Participant, Admin, Mod√©rateur
  joinedAt       DateTime  @default(now())
  leftAt         DateTime? // Si null, le participant est toujours dans la conversation

  // Relations
  Conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([conversationId, userId])
  @@map("conversation_participants")
}

// Mod√®le pour les messages du chat
model Message {
  id             String    @id @default(cuid())
  conversationId String
  userId         String // ID de l'utilisateur qui a envoy√© le message
  content        String    @db.Text // Contenu du message
  type           String    @default("Texte") // Texte, Image, Fichier, System
  fileUrl        String?   @db.VarChar(500) // URL du fichier si type = Image ou Fichier
  fileName       String?   @db.VarChar(255) // Nom du fichier original
  replyToId      String? // ID du message auquel on r√©pond (pour les r√©ponses)
  edited         Boolean   @default(false) // Si le message a √©t√© modifi√©
  editedAt       DateTime? // Date de modification
  deleted        Boolean   @default(false) // Si le message a √©t√© supprim√©
  deletedAt      DateTime? // Date de suppression

  // Relations
  Conversation Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  ReplyTo      Message?          @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  Replies      Message[]         @relation("MessageReplies")
  Reactions    MessageReaction[] // R√©actions aux messages

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([conversationId, createdAt])
  @@index([userId])
  @@map("messages")
}

// Mod√®le pour les r√©actions aux messages (emojis, likes, etc.)
model MessageReaction {
  id        String @id @default(cuid())
  messageId String
  userId    String
  reaction  String @db.VarChar(10) // Emoji ou type de r√©action (üëç, ‚ù§Ô∏è, etc.)

  // Relations
  Message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  User    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())

  @@unique([messageId, userId, reaction])
  @@map("message_reactions")
}

// Enum pour le statut d'une id√©e
enum StatutIdee {
  EnAttente
  Validee
  Rejetee
  Bloquee
  DevenueProjet
}

enum StatutDemandeSuppression {
  EnAttente // Demande re√ßue, en attente de v√©rification
  EnVerification // V√©rification d'identit√© en cours
  Approuvee // Demande approuv√©e, suppression programm√©e
  Rejetee // Demande rejet√©e (identit√© non v√©rifi√©e, etc.)
  Completee // Suppression effectu√©e
  Annulee // Demande annul√©e par l'utilisateur ou l'admin
}

enum TypeNotification {
  Systeme
  Email
  Action
  Cotisation
  Idee
  Election
  Evenement
  Chat
  Autre
}

enum TypeDocument {
  PDF
  Image
  Video
  Excel
  Word
  Autre
}

// Mod√®le pour les id√©es de la bo√Æte √† id√©es
model Idee {
  id                 String     @id @default(cuid())
  titre              String     @db.VarChar(255)
  description        String     @db.Text
  adherentId         String // Auteur de l'id√©e
  statut             StatutIdee @default(EnAttente)
  nombreCommentaires Int        @default(0) // Compteur de commentaires
  nombreApprobations Int        @default(0) // Compteur d'approbations

  // Dates importantes
  dateCreation   DateTime  @default(now())
  dateValidation DateTime? // Date de validation par l'admin
  dateRejet      DateTime? // Date de rejet par l'admin
  dateBlocage    DateTime? // Date de blocage par l'admin

  // Raison du rejet ou du blocage
  raisonRejet String? @db.Text // Raison du rejet (viole l'√©thique, propos diffamatoires, etc.)

  // Admin qui a valid√©/rejet√©/bloqu√©
  valideePar String? // ID de l'admin qui a valid√©
  rejeteePar String? // ID de l'admin qui a rejet√©
  bloqueePar String? // ID de l'admin qui a bloqu√©

  // Si l'id√©e est d√©j√† lue (pour emp√™cher la suppression directe)
  estLue Boolean @default(false) // Si au moins un commentaire ou approbation existe

  // Relations
  Adherent     Adherent          @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  Commentaires CommentaireIdee[] // Commentaires sur cette id√©e
  Approbations ApprobationIdee[] // Approbations de cette id√©e

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([adherentId])
  @@index([statut])
  @@index([dateCreation])
  @@map("idees")
}

// Enum pour le type de badge
enum BadgeType {
  Automatique
  Manuel
}

// Mod√®le pour les badges
model Badge {
  id           String             @id @default(cuid())
  nom          String             @db.VarChar(255)
  description  String             @db.Text
  icone        String             @db.VarChar(100) // Nom de l'ic√¥ne lucide-react
  couleur      String             @db.VarChar(50) // Couleur du badge (ex: "blue", "green", "gold")
  type         BadgeType          @default(Manuel)
  condition    String?            @db.Text // Condition JSON pour badges automatiques
  actif        Boolean            @default(true)
  ordre        Int                @default(0) // Ordre d'affichage
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  Attributions BadgeAttribution[]

  @@index([type])
  @@index([actif])
  @@map("badges")
}

// Mod√®le pour les attributions de badges aux utilisateurs
model BadgeAttribution {
  id          String   @id @default(cuid())
  badgeId     String
  userId      String
  attribuePar String? // ID de l'admin qui a attribu√© (si manuel)
  raison      String?  @db.Text // Raison de l'attribution
  createdAt   DateTime @default(now())

  // Relations
  Badge Badge @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  User  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([badgeId, userId])
  @@index([userId])
  @@index([badgeId])
  @@index([createdAt])
  @@map("badge_attributions")
}

// Mod√®le pour les commentaires sur les id√©es
model CommentaireIdee {
  id                String  @id @default(cuid())
  ideeId            String
  adherentId        String // Auteur du commentaire
  contenu           String  @db.Text
  supprime          Boolean @default(false) // Si le commentaire a √©t√© supprim√© par l'admin
  raisonSuppression String? @db.Text // Raison de la suppression

  // Relations
  Idee     Idee     @relation(fields: [ideeId], references: [id], onDelete: Cascade)
  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ideeId])
  @@index([adherentId])
  @@map("commentaires_idee")
}

// Mod√®le pour les approbations (votes/likes) des id√©es
model ApprobationIdee {
  id         String @id @default(cuid())
  ideeId     String
  adherentId String // Adh√©rent qui approuve

  // Relations
  Idee     Idee     @relation(fields: [ideeId], references: [id], onDelete: Cascade)
  Adherent Adherent @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())

  @@unique([ideeId, adherentId])
  @@index([ideeId])
  @@index([adherentId])
  @@map("approbations_idee")
}

// Mod√®le pour les notifications utilisateur
model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      TypeNotification @default(Systeme)
  titre     String           @db.VarChar(255)
  message   String           @db.Text
  lien      String?          @db.VarChar(500) // URL optionnelle pour redirection
  lue       Boolean          @default(false)
  createdAt DateTime         @default(now())
  User      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lue])
  @@index([createdAt])
  @@map("notifications")
}

// Mod√®le pour l'historique des emails envoy√©s aux adh√©rents
model Email {
  id             String   @id @default(cuid())
  userId         String // Destinataire de l'email
  createdBy      String // Admin qui a envoy√© l'email
  subject        String   @db.VarChar(255)
  body           String   @db.Text
  recipientEmail String   @db.VarChar(255) // Email du destinataire au moment de l'envoi
  sent           Boolean  @default(true) // Si l'email a √©t√© envoy√© avec succ√®s
  error          String?  @db.Text // Message d'erreur si l'envoi a √©chou√©
  createdAt      DateTime @default(now())

  // Relations
  User      User @relation("EmailRecipient", fields: [userId], references: [id], onDelete: Cascade)
  CreatedBy User @relation("EmailCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdBy])
  @@index([createdAt])
  @@index([sent])
  @@map("emails")
}

// Mod√®le pour l'historique des suppressions d'adh√©rents
model SuppressionAdherent {
  id                String   @id @default(cuid())
  userId            String // ID de l'utilisateur supprim√© (conserv√© pour r√©f√©rence)
  userName          String   @db.VarChar(255) // Nom de l'utilisateur au moment de la suppression
  userEmail         String?  @db.VarChar(255) // Email de l'utilisateur au moment de la suppression
  userRole          UserRole // R√¥le de l'utilisateur au moment de la suppression
  adherentFirstName String?  @db.VarChar(100) // Pr√©nom de l'adh√©rent si existait
  adherentLastName  String?  @db.VarChar(100) // Nom de l'adh√©rent si existait
  reason            String   @db.Text // Raison de la suppression
  notifyUser        Boolean  @default(false) // Si un email de notification a √©t√© envoy√©
  deletedBy         String // ID de l'admin qui a effectu√© la suppression
  deletedByName     String   @db.VarChar(255) // Nom de l'admin au moment de la suppression
  deletedByEmail    String?  @db.VarChar(255) // Email de l'admin au moment de la suppression
  createdAt         DateTime @default(now())

  // Relations
  DeletedBy User @relation("SuppressionDeletedBy", fields: [deletedBy], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deletedBy])
  @@index([createdAt])
  @@index([userEmail])
  @@map("suppressions_adherent")
}

// Mod√®le pour les demandes de suppression de donn√©es (RGPD)
model DataDeletionRequest {
  id              String                   @id @default(cuid())
  userId          String // ID de l'utilisateur qui fait la demande
  userEmail       String                   @db.VarChar(255) // Email de l'utilisateur
  userName        String?                  @db.VarChar(255) // Nom de l'utilisateur au moment de la demande
  message         String?                  @db.Text // Message optionnel de l'utilisateur
  statut          StatutDemandeSuppression @default(EnAttente)
  verifiedAt      DateTime? // Date de v√©rification d'identit√©
  verifiedBy      String? // ID de l'admin qui a v√©rifi√©
  verifiedByName  String?                  @db.VarChar(255) // Nom de l'admin qui a v√©rifi√©
  approvedAt      DateTime? // Date d'approbation
  approvedBy      String? // ID de l'admin qui a approuv√©
  approvedByName  String?                  @db.VarChar(255) // Nom de l'admin qui a approuv√©
  rejectedAt      DateTime? // Date de rejet
  rejectedBy      String? // ID de l'admin qui a rejet√©
  rejectedByName  String?                  @db.VarChar(255) // Nom de l'admin qui a rejet√©
  rejectionReason String?                  @db.Text // Raison du rejet
  completedAt     DateTime? // Date de suppression effective
  completedBy     String? // ID de l'admin qui a effectu√© la suppression
  completedByName String?                  @db.VarChar(255) // Nom de l'admin qui a effectu√© la suppression
  dataExported    Boolean                  @default(false) // Si les donn√©es ont √©t√© export√©es avant suppression
  exportPath      String?                  @db.VarChar(500) // Chemin du fichier d'export si export√©
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt

  // Relations
  User        User  @relation("DataDeletionRequestUser", fields: [userId], references: [id], onDelete: Cascade)
  VerifiedBy  User? @relation("DataDeletionRequestVerifiedBy", fields: [verifiedBy], references: [id], onDelete: SetNull)
  ApprovedBy  User? @relation("DataDeletionRequestApprovedBy", fields: [approvedBy], references: [id], onDelete: SetNull)
  RejectedBy  User? @relation("DataDeletionRequestRejectedBy", fields: [rejectedBy], references: [id], onDelete: SetNull)
  CompletedBy User? @relation("DataDeletionRequestCompletedBy", fields: [completedBy], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([userEmail])
  @@index([statut])
  @@index([createdAt])
  @@index([verifiedBy])
  @@index([approvedBy])
  @@map("data_deletion_requests")
}

// Mod√®le pour les documents upload√©s
model Document {
  id          String       @id @default(cuid())
  userId      String
  adherentId  String? // Optionnel, pour lier √† un adh√©rent sp√©cifique
  nom         String       @db.VarChar(255) // Nom du fichier stock√©
  nomOriginal String       @db.VarChar(255) // Nom original du fichier
  type        TypeDocument
  categorie   String?      @db.VarChar(100) // Cat√©gorie personnalis√©e
  chemin      String       @db.VarChar(500) // Chemin relatif dans /public/ressources
  taille      Int // Taille en bytes
  mimeType    String       @db.VarChar(100)
  description String?      @db.Text
  estPublic   Boolean      @default(false) // Si visible par les admins
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  User        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Adherent    Adherent?    @relation("DocumentAdherent", fields: [adherentId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([adherentId])
  @@index([type])
  @@index([createdAt])
  @@map("documents")
}

// Mod√®le pour les rapports de r√©unions mensuelles
model RapportReunion {
  id          String   @id @default(cuid())
  titre       String   @db.VarChar(255) // Titre du rapport (ex: "R√©union mensuelle - Janvier 2024")
  dateReunion DateTime // Date de la r√©union
  contenu     String   @db.Text // Contenu du rapport (markdown ou texte)
  createdBy   String // Admin qui a cr√©√© le rapport
  updatedBy   String? // Admin qui a modifi√© le rapport
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  CreatedBy User  @relation("RapportReunionCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  UpdatedBy User? @relation("RapportReunionUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([dateReunion])
  @@index([createdAt])
  @@index([createdBy])
  @@map("rapports_reunion")
}

// Mod√®les pour le syst√®me de r√©servations et gestion de ressources

enum TypeRessource {
  Salle
  Materiel
  Vehicule
  Autre
}

enum StatutReservation {
  EnAttente
  Confirmee
  Annulee
  Terminee
}

model Ressource {
  id           String        @id @default(cuid())
  nom          String        @db.VarChar(255)
  type         TypeRessource
  description  String?       @db.Text
  capacite     Int? // Pour les salles : nombre de places
  localisation String?       @db.VarChar(255) // Adresse ou emplacement
  image        String?       @db.VarChar(500) // URL de l'image

  // Configuration
  actif      Boolean @default(true)
  reservable Boolean @default(true) // Si la ressource peut √™tre r√©serv√©e

  // Horaires de disponibilit√© (optionnel)
  horairesOuverture String? @db.Text // JSON : { "lundi": { "debut": "08:00", "fin": "18:00" }, ... }

  // Tarification (optionnel)
  tarifHoraire    Decimal? @db.Decimal(10, 2)
  tarifJournalier Decimal? @db.Decimal(10, 2)

  // Relations
  reservations Reservation[]

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
  CreatedBy User     @relation("RessourceCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("ressources")
}

model Reservation {
  id          String  @id @default(cuid())
  ressourceId String
  adherentId  String? // Optionnel pour permettre les r√©servations de visiteurs

  // Dates et heures
  dateDebut   DateTime
  dateFin     DateTime
  dureeHeures Decimal? @db.Decimal(10, 2) // Dur√©e en heures

  // Statut
  statut StatutReservation @default(EnAttente)

  // Informations de r√©servation
  motif           String? @db.Text // Raison de la r√©servation
  nombrePersonnes Int? // Nombre de personnes (pour les salles)
  commentaires    String? @db.Text

  // Informations du visiteur (pour les non-adh√©rents)
  visiteurNom       String? @db.VarChar(255)
  visiteurEmail     String? @db.VarChar(255)
  visiteurTelephone String? @db.VarChar(20)

  // Confirmation
  confirmeePar     String? // ID de l'admin qui a confirm√©
  dateConfirmation DateTime?

  // Relations
  Ressource    Ressource @relation(fields: [ressourceId], references: [id], onDelete: Cascade)
  Adherent     Adherent? @relation(fields: [adherentId], references: [id], onDelete: Cascade)
  ConfirmeePar User?     @relation("ReservationConfirmeePar", fields: [confirmeePar], references: [id], onDelete: SetNull)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ressourceId, dateDebut, dateFin])
  @@index([adherentId])
  @@index([statut])
  @@map("reservations")
}

// Mod√®le pour la galerie (photos et vid√©os)
model MediaGalerie {
  id          String   @id @default(cuid())
  titre       String   @db.VarChar(255)
  description String?  @db.Text
  type        String // "image" ou "video"
  chemin      String   @db.VarChar(500) // Chemin relatif dans /public/ressources/galeries
  nomFichier  String   @db.VarChar(255) // Nom du fichier original
  mimeType    String   @db.VarChar(100)
  taille      Int // Taille en bytes
  categorie   String   @db.VarChar(100) // "√âv√©nements Officiels", "√âv√©nements Sociaux", "Actions Caritatives", "Formations et Conf√©rences"
  couleur     String   @default("blue") @db.VarChar(50) // "blue", "green", "purple", "orange"
  date        DateTime // Date de l'√©v√©nement ou de la prise
  lieu        String?  @db.VarChar(200) // Lieu o√π la photo/vid√©o a √©t√© prise
  ordre       Int      @default(0) // Ordre d'affichage dans la cat√©gorie
  actif       Boolean  @default(true) // Si le m√©dia est visible publiquement
  createdBy   String // ID de l'admin qui a ajout√© le m√©dia

  // Relations
  CreatedBy User @relation("MediaGalerieCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categorie])
  @@index([type])
  @@index([actif])
  @@index([ordre])
  @@index([date])
  @@map("media_galerie")
}

// Table pour stocker les villes Geonames
model GeonamesCity {
  id             Int     @id @default(autoincrement())
  geonameId      Int     @unique
  name           String  @db.VarChar(200)
  asciiName      String? @db.VarChar(200)
  alternateNames String? @db.Text
  latitude       Float?
  longitude      Float?
  countryCode    String  @db.VarChar(2)
  admin1Code     String? @db.VarChar(20) // Code r√©gion/d√©partement
  admin2Code     String? @db.VarChar(80)
  admin3Code     String? @db.VarChar(20)
  admin4Code     String? @db.VarChar(20)
  population     BigInt?
  elevation      Int?
  timezone       String? @db.VarChar(40)
  featureClass   String? @db.VarChar(1)
  featureCode    String? @db.VarChar(10)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([countryCode])
  @@index([name])
  @@index([asciiName])
  @@index([countryCode, name])
  @@map("geonames_city")
}

// Table pour stocker les pays Geonames
model GeonamesCountry {
  id             Int     @id @default(autoincrement())
  geonameId      Int     @unique
  name           String  @db.VarChar(200)
  asciiName      String? @db.VarChar(200)
  alternateNames String? @db.Text
  latitude       Float?
  longitude      Float?
  countryCode    String  @unique @db.VarChar(2) // Code pays ISO 2 lettres (unique)
  cc2            String? @db.VarChar(60) // Codes pays alternatifs
  admin1Code     String? @db.VarChar(20)
  admin2Code     String? @db.VarChar(80)
  admin3Code     String? @db.VarChar(20)
  admin4Code     String? @db.VarChar(20)
  population     BigInt?
  elevation      Int?
  timezone       String? @db.VarChar(40)
  featureClass   String  @db.VarChar(1) // 'A' pour administrative boundaries
  featureCode    String  @db.VarChar(10) // 'PCLI' pour independent political entity

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([countryCode])
  @@index([name])
  @@index([asciiName])
  @@index([featureClass, featureCode])
  @@map("geonames_country")
}

// Table pour stocker les pays depuis Carto ou autres sources
model Country {
  id           Int     @id @default(autoincrement())
  name         String  @db.VarChar(200)
  nameEn       String? @db.VarChar(200) // Nom en anglais
  nameFr       String? @db.VarChar(200) // Nom en fran√ßais
  code         String  @unique @db.VarChar(2) // Code ISO 2 lettres (unique)
  code3        String? @db.VarChar(3) // Code ISO 3 lettres
  capital      String? @db.VarChar(200) // Capitale
  region       String? @db.VarChar(100) // R√©gion (Europe, Afrique, etc.)
  subregion    String? @db.VarChar(100) // Sous-r√©gion
  latitude     Float? // Latitude de la capitale ou du centre
  longitude    Float? // Longitude de la capitale ou du centre
  population   BigInt? // Population
  area         Float? // Superficie en km¬≤
  currency     String? @db.VarChar(10) // Code devise (EUR, USD, etc.)
  currencyName String? @db.VarChar(100) // Nom de la devise
  languages    String? @db.Text // Langues (JSON array)
  timezones    String? @db.Text // Fuseaux horaires (JSON array)
  flag         String? @db.VarChar(500) // URL du drapeau
  source       String  @default("carto") @db.VarChar(50) // Source des donn√©es (carto, restcountries, etc.)
  externalId   String? @db.VarChar(100) // ID externe (pour r√©f√©rence)
  metadata     Json? // M√©tadonn√©es suppl√©mentaires (JSON)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
  @@index([name])
  @@index([nameFr])
  @@index([region])
  @@index([source])
  @@map("country")
}

// Table pour stocker les villes depuis Carto ou autres sources
model City {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(200)
  nameEn      String? @db.VarChar(200) // Nom en anglais
  nameFr      String? @db.VarChar(200) // Nom en fran√ßais
  countryCode String  @db.VarChar(2) // Code pays ISO 2 lettres
  region      String? @db.VarChar(100) // R√©gion/√âtat/Province
  department  String? @db.VarChar(100) // D√©partement (pour la France)
  postalCode  String? @db.VarChar(20) // Code postal
  latitude    Float?
  longitude   Float?
  population  BigInt? // Population
  elevation   Int? // Altitude en m√®tres
  timezone    String? @db.VarChar(50) // Fuseau horaire
  isCapital   Boolean @default(false) // Si c'est une capitale
  isMajor     Boolean @default(false) // Si c'est une grande ville
  source      String  @default("carto") @db.VarChar(50) // Source des donn√©es
  externalId  String? @db.VarChar(100) // ID externe
  metadata    Json? // M√©tadonn√©es suppl√©mentaires (JSON)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([countryCode])
  @@index([name])
  @@index([nameFr])
  @@index([countryCode, name])
  @@index([postalCode])
  @@index([region])
  @@index([source])
  @@map("city")
}

// Table pour stocker les configurations de l'application
model AppSettings {
  id          String   @id @default(cuid())
  key         String   @unique @db.VarChar(100) // Cl√© unique pour identifier le param√®tre
  value       String   @db.Text // Valeur du param√®tre (peut √™tre JSON)
  description String?  @db.VarChar(500) // Description du param√®tre
  category    String   @default("general") @db.VarChar(50) // Cat√©gorie (email, payment, general, etc.)
  updatedBy   String? // ID de l'utilisateur qui a modifi√©
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([key])
  @@index([category])
  @@map("app_settings")
}

model Menu {
  id          String     @id @default(cuid())
  libelle     String     @db.VarChar(100) // Texte affich√© (ex: "Admin", "√âlections")
  description String?    @db.VarChar(500) // Description du menu
  lien        String     @db.VarChar(255) // URL du lien (ex: "/admin", "/elections")
  niveau      MenuNiveau // 0=NAVBAR, 1=SIDEBAR
  roles       String[] // Array de r√¥les (ex: ["ADMIN", "PRESID"])
  icone       String?    @db.VarChar(100) // Nom de l'ic√¥ne Lucide (ex: "Shield", "Calendar")
  statut      Boolean    @default(true) // true=actif, false=inactif
  ordre       Int        @default(0) // Ordre d'affichage
  parent      String? // ID du menu parent (pour sous-menus)
  electoral   Boolean    @default(false) // Si true, soumis au param√®tre electoral_menu_enabled
  createdBy   String? // ID de l'utilisateur qui a cr√©√©
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  CreatedBy User? @relation("MenuCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([niveau])
  @@index([statut])
  @@index([ordre])
  @@index([electoral])
  @@map("menus")
}

// Enum pour les types d'activit√©s utilisateurs
enum TypeActivite {
  Connexion
  Deconnexion
  Creation
  Modification
  Suppression
  Consultation
  Export
  Import
  Authentification
  ChangementMotDePasse
  Autre
}

// Table pour tracer les activit√©s des utilisateurs
model UserActivity {
  id           String       @id @default(cuid())
  userId       String // ID de l'utilisateur qui a effectu√© l'action
  userName     String?      @db.VarChar(255) // Nom de l'utilisateur au moment de l'action
  userEmail    String?      @db.VarChar(255) // Email de l'utilisateur au moment de l'action
  type         TypeActivite // Type d'activit√©
  action       String       @db.VarChar(255) // Description de l'action (ex: "Cr√©ation d'un √©v√©nement")
  entityType   String?      @db.VarChar(100) // Type d'entit√© concern√©e (ex: "Evenement", "User", "Cotisation")
  entityId     String?      @db.VarChar(255) // ID de l'entit√© concern√©e
  details      Json? // D√©tails suppl√©mentaires de l'action (JSON)
  ipAddress    String?      @db.VarChar(45) // Adresse IP de l'utilisateur
  userAgent    String?      @db.VarChar(500) // User Agent du navigateur
  url          String?      @db.VarChar(500) // URL de la page o√π l'action a √©t√© effectu√©e
  success      Boolean      @default(true) // Si l'action a r√©ussi
  errorMessage String?      @db.Text // Message d'erreur si l'action a √©chou√©
  createdAt    DateTime     @default(now())

  // Relations
  User User @relation("UserActivities", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([entityType])
  @@index([entityId])
  @@index([createdAt])
  @@index([success])
  @@map("user_activities")
}

// Enum pour le statut d'un projet
enum StatutProjet {
  Planifie // Projet planifi√©, pas encore d√©marr√©
  EnCours // Projet en cours d'ex√©cution
  EnPause // Projet mis en pause temporairement
  Termine // Projet termin√©
  Annule // Projet annul√©
}

// Enum pour le statut d'un sous-projet/t√¢che
enum StatutSousProjet {
  APlanifier // T√¢che √† planifier
  EnAttente // T√¢che en attente de d√©marrage
  EnCours // T√¢che en cours d'ex√©cution
  EnPause // T√¢che mise en pause
  Terminee // T√¢che termin√©e
  Annulee // T√¢che annul√©e
}

// Table pour les projets de l'association
model Projet {
  id            String       @id @default(cuid())
  titre         String       @db.VarChar(255) // Titre du projet
  description   String       @db.Text // Description d√©taill√©e du projet
  statut        StatutProjet @default(Planifie)
  dateDebut     DateTime? // Date de d√©but pr√©vue ou effective
  dateFin       DateTime? // Date de fin pr√©vue ou effective
  dateFinReelle DateTime? // Date de fin r√©elle (si termin√©)
  createdBy     String // ID de l'admin qui a cr√©√© le projet

  // Relations
  CreatedBy   User         @relation("ProjetCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  SousProjets SousProjet[] // Sous-projets/t√¢ches du projet

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([statut])
  @@index([createdBy])
  @@index([dateDebut])
  @@index([dateFin])
  @@map("projets")
}

// Table pour les sous-projets/t√¢ches
model SousProjet {
  id            String           @id @default(cuid())
  projetId      String // R√©f√©rence au projet parent
  titre         String           @db.VarChar(255) // Titre de la t√¢che
  description   String           @db.Text // Description d√©taill√©e de la t√¢che
  statut        StatutSousProjet @default(APlanifier)
  ordre         Int              @default(0) // Ordre d'affichage dans la liste
  dateDebut     DateTime? // Date de d√©but pr√©vue ou effective
  dateFin       DateTime? // Date de fin pr√©vue ou effective
  dateFinReelle DateTime? // Date de fin r√©elle (si termin√©e)

  // Relations
  Projet       Projet                  @relation(fields: [projetId], references: [id], onDelete: Cascade)
  Affectations AffectationSousProjet[] // Adh√©rents affect√©s √† cette t√¢che
  Commentaires CommentaireTache[] // Commentaires sur l'√©volution de la t√¢che

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projetId])
  @@index([statut])
  @@index([ordre])
  @@map("sous_projets")
}

// Table de liaison pour les affectations (many-to-many entre SousProjet et Adherent)
model AffectationSousProjet {
  id                 String    @id @default(cuid())
  sousProjetId       String // R√©f√©rence au sous-projet/t√¢che
  adherentId         String // R√©f√©rence √† l'adh√©rent affect√©
  dateAffectation    DateTime  @default(now()) // Date d'affectation
  dateFinAffectation DateTime? // Date de fin d'affectation (si l'adh√©rent est retir√© avant la fin du projet)
  responsable        Boolean   @default(false) // Si true, l'adh√©rent est responsable de cette t√¢che

  // Relations
  SousProjet SousProjet @relation(fields: [sousProjetId], references: [id], onDelete: Cascade)
  Adherent   Adherent   @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([sousProjetId, adherentId]) // Un adh√©rent ne peut √™tre affect√© qu'une fois √† une t√¢che
  @@index([sousProjetId])
  @@index([adherentId])
  @@index([dateAffectation])
  @@map("affectations_sous_projets")
}

// Table pour les commentaires sur l'√©volution des t√¢ches
model CommentaireTache {
  id                    String @id @default(cuid())
  sousProjetId          String // R√©f√©rence au sous-projet/t√¢che
  adherentId            String // Adh√©rent qui a fait le commentaire
  contenu               String @db.Text // Contenu du commentaire
  pourcentageAvancement Int? // Pourcentage d'avancement (0-100) si l'adh√©rent le pr√©cise

  // Relations
  SousProjet SousProjet @relation(fields: [sousProjetId], references: [id], onDelete: Cascade)
  Adherent   Adherent   @relation(fields: [adherentId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sousProjetId])
  @@index([adherentId])
  @@index([createdAt])
  @@map("commentaires_taches")
}

// Mod√®le pour les r√¥les d'administration des utilisateurs
// Permet √† un utilisateur d'avoir plusieurs r√¥les d'administration
model UserAdminRole {
  id        String    @id @default(cuid())
  userId    String
  role      AdminRole
  createdAt DateTime  @default(now())
  createdBy String // ID de l'admin qui a attribu√© ce r√¥le
  updatedAt DateTime  @updatedAt

  // Relations
  user    User @relation("UserAdminRoles", fields: [userId], references: [id], onDelete: Cascade)
  creator User @relation("UserAdminRoleCreator", fields: [createdBy], references: [id], onDelete: Restrict)

  @@unique([userId, role]) // Un utilisateur ne peut avoir qu'une seule instance de chaque r√¥le
  @@index([userId])
  @@index([role])
  @@index([createdBy])
  @@map("user_admin_roles")
}
