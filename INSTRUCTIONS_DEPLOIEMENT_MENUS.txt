â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     INSTRUCTIONS DE DÃ‰PLOIEMENT - MENUS HIÃ‰RARCHIQUES               â•‘
â•‘                    Version 1.0.0 - 2026-01-13                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ RÃ‰SUMÃ‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cette mise Ã  jour implÃ©mente un systÃ¨me de menus hiÃ©rarchiques avec dropdown
pour regrouper les options Ã©lectorales sous un menu parent "Scrutin".

âœ… Avantages:
  â€¢ Scroll horizontal Ã©liminÃ© dans la navbar
  â€¢ Interface plus professionnelle avec dropdown Radix UI
  â€¢ Meilleure organisation thÃ©matique des menus
  â€¢ Aucun breaking change (100% rÃ©trocompatible)


ğŸš€ DÃ‰PLOIEMENT AUTOMATIQUE (RECOMMANDÃ‰)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Connexion SSH au serveur:
  ssh votre_user@serveur-production
  cd /sites/amakifr

ExÃ©cution du script automatisÃ©:
  bash scripts/deploy-menus-hierarchiques.sh

Le script effectue automatiquement:
  âœ“ Installation des dÃ©pendances
  âœ“ GÃ©nÃ©ration du client Prisma
  âœ“ Sauvegarde des menus actuels
  âœ“ Re-seeding des menus avec hiÃ©rarchie
  âœ“ Build de l'application
  âœ“ RedÃ©marrage PM2
  âœ“ VÃ©rifications post-dÃ©ploiement

DurÃ©e estimÃ©e: 5-10 minutes


ğŸ“‹ DÃ‰PLOIEMENT MANUEL (SI BESOIN)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Pull du code:
   cd /sites/amakifr
   git pull origin main

2. Installation:
   npm install

3. Prisma:
   npx prisma generate

4. Re-seed des menus:
   bash scripts/seed-menus-auto.sh
   
   âš ï¸ IMPORTANT: Ceci va supprimer et recrÃ©er tous les menus
   
   RÃ©sultat attendu:
   âœ… 35 menus crÃ©Ã©s (7 NAVBAR parents + 2 enfants + 26 SIDEBAR)
   âœ… 2 sous-menus Ã©lectoraux (Informations, RÃ©sultats)

5. Build:
   npm run build

6. RedÃ©marrage:
   pm2 restart amakifr


ğŸ§ª TESTS POST-DÃ‰PLOIEMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. VÃ©rifier le dÃ©marrage:
   pm2 logs amakifr --lines 50
   â†’ Chercher "âœ“ Ready in XXms"

2. Tester la navbar (Desktop):
   â€¢ Ouvrir https://www.amaki.fr/
   â€¢ VÃ©rifier le menu "Scrutin" avec chevron (â–¼)
   â€¢ Survoler "Scrutin" â†’ Le dropdown s'ouvre
   â€¢ Cliquer sur "Informations" â†’ Redirige vers /extrat
   â€¢ Cliquer sur "RÃ©sultats" â†’ Redirige vers /resultats
   â€¢ VÃ©rifier qu'il n'y a PAS de scroll horizontal

3. Tester le menu mobile:
   â€¢ Ouvrir le menu burger (â˜°)
   â€¢ VÃ©rifier "Scrutin" en gris (non cliquable)
   â€¢ VÃ©rifier "Informations" et "RÃ©sultats" indentÃ©s
   â€¢ Cliquer sur un sous-menu â†’ Le menu se ferme

4. Tester le filtrage Ã©lectoral:
   â€¢ Aller dans /admin/settings
   â€¢ DÃ©sactiver "Menus Ã©lectoraux"
   â€¢ Retourner sur la page d'accueil
   â€¢ VÃ©rifier que "Scrutin" n'apparaÃ®t plus


âš ï¸ RÃ‰SOLUTION DE PROBLÃˆMES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ Erreur: "Cannot find module '@radix-ui/react-dropdown-menu'"
   Solution:
   npm install @radix-ui/react-dropdown-menu
   npm run build
   pm2 restart amakifr

âŒ Les sous-menus n'apparaissent pas
   Diagnostic:
   psql -h localhost -U postgres -d amakifr -c \
     "SELECT COUNT(*) FROM menus WHERE parent IS NOT NULL;"
   
   Si rÃ©sultat = 0:
   bash scripts/seed-menus-auto.sh

âŒ Le dropdown ne s'ouvre pas
   Solution:
   1. Vider le cache du navigateur (Ctrl+Shift+R)
   2. Rebuild: rm -rf .next && npm run build && pm2 restart amakifr

âŒ Application ne dÃ©marre pas
   VÃ©rifier les logs:
   pm2 logs amakifr --lines 100 --err


ğŸ”„ ROLLBACK (SI NÃ‰CESSAIRE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Retour au commit prÃ©cÃ©dent:
  cd /sites/amakifr
  git log --oneline -5
  git checkout fb0bc73  # Commit avant menus hiÃ©rarchiques
  npm install
  npm run build
  pm2 restart amakifr

Restaurer les menus depuis la sauvegarde:
  psql -h localhost -U postgres -d amakifr -c "DELETE FROM menus;"
  psql -h localhost -U postgres -d amakifr < /tmp/menus_backup_*.sql


ğŸ“š DOCUMENTATION COMPLÃˆTE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Pour plus de dÃ©tails, consulter:
  â€¢ docs/MENUS_HIERARCHIQUES.md (Guide technique)
  â€¢ docs/DEPLOIEMENT_MENUS_HIERARCHIQUES.md (ProcÃ©dure dÃ©taillÃ©e)
  â€¢ CHANGELOG_MENUS_HIERARCHIQUES.md (Historique)


âœ… CHECKLIST FINALE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â–¡ Code pulÃ© depuis main
â–¡ Script deploy-menus-hierarchiques.sh exÃ©cutÃ©
â–¡ Tests desktop (dropdown fonctionne)
â–¡ Tests mobile (indentation visible)
â–¡ VÃ©rification logs PM2 (pas d'erreur)
â–¡ Scroll horizontal Ã©liminÃ©
â–¡ Performance stable (< 2s temps de chargement)


ğŸ“ SUPPORT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

En cas de problÃ¨me:
  1. Consulter docs/DEPLOIEMENT_MENUS_HIERARCHIQUES.md
  2. VÃ©rifier pm2 logs amakifr
  3. Contacter l'Ã©quipe technique


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        FIN DES INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
